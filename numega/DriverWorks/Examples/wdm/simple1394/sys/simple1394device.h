// Simple1394Device.h
//
// Generated by DriverWizard version DriverStudio 2.5.0 (Build 44)
// Requires Compuware's DriverWorks classes
//

#ifndef __Simple1394Device_h__
#define __Simple1394Device_h__

// TODO:	The wizard creates a single driver managed queue class.
//			You may choose to create additional classes derived from
//			KDriverManagedQueueCsq to help manage Irp processing.	
class Simple1394Device_DriverManagedQueue : public KDriverManagedQueueCsq
{
public:
	SAFE_DESTRUCTORS;
	VOID StartIo(KIrp I);
};


class Simple1394Device : public KPnpDevice
{
	// Constructors
public:
	SAFE_DESTRUCTORS;
	Simple1394Device(PDEVICE_OBJECT Pdo);
	~Simple1394Device();

	// Member Functions
public:
	DEVMEMBER_DISPATCHERS
	virtual NTSTATUS OnStartDevice(KIrp I);
	virtual NTSTATUS OnStopDevice(KIrp I);
	virtual NTSTATUS OnRemoveDevice(KIrp I);
	virtual NTSTATUS DefaultPnp(KIrp I);
	virtual NTSTATUS DefaultPower(KIrp I);
	virtual NTSTATUS OnDevicePowerUp(KIrp I);
	virtual NTSTATUS OnDeviceSleep(KIrp I);
	void SerialRead(KIrp I);
	void SerialWrite(KIrp I);

#ifdef _COMMENT_ONLY

		// The following member functions are actually defined by the
		// a DEVMEMBER_xxx or MEMBER_xxx macro (such as DEVMEMBER_DISPATCHERS).
		// The macro __COMMENT_ONLY never gets defined.  These comment-only
		// definitions simply allow easy navigation to the functions within
		// the Developer Studio using the class browser.

	virtual NTSTATUS CleanUp(KIrp I);				// COMMENT_ONLY
	virtual NTSTATUS Create(KIrp I);				// COMMENT_ONLY
	virtual NTSTATUS Close(KIrp I);					// COMMENT_ONLY
	virtual NTSTATUS SystemControl(KIrp I);			// COMMENT_ONLY
	virtual NTSTATUS ReadWrite(KIrp I);				// COMMENT_ONLY
#endif

protected:

	typedef struct _COMPLETE_CONTEXT
	{
		Simple1394Device_DriverManagedQueue*	pQueue;
		KIrp									I;
	} COMPLETE_CONTEXT, *PCOMPLETE_CONTEXT;


	static NTSTATUS __stdcall ReadWriteComplete(PDEVICE_OBJECT DeviceObject, PIRP pIrp, PVOID Context);


	// Member Data
protected:
	K1394LowerDevice		m_1394Bus;
	K1394GenerationCount	m_GenerationCount;

	Simple1394Device_DriverManagedQueue m_DriverManagedQueue;
};

#endif
