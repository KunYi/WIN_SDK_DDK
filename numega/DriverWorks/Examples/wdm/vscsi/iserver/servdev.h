// servdev.h
//
// Generated by DriverWizard version DriverStudio 2.7.0 (Build 554)
// Requires Compuware's DriverWorks classes
//

#ifndef __SERVDEV_H__
#define __SERVDEV_H__

#include "isession.h"

#define VSCSI_BUFFER_SIZE		0x400000

////////////////////////////////////////////////////////////////////////////
//
// ServerDevice class 
//		functional device class
//
class ServerDevice : public KPnpDevice
{
	friend class ReadWriteSession;

	// Constructors
public:
	SAFE_DESTRUCTORS;
	ServerDevice(PDEVICE_OBJECT Pdo);
	~ServerDevice();

	// Member Functions
public:
	DEVMEMBER_DISPATCHERS
	virtual NTSTATUS OnStartDevice(KIrp I);
	virtual NTSTATUS OnStopDevice(KIrp I);
	virtual NTSTATUS OnRemoveDevice(KIrp I);
	virtual NTSTATUS DefaultPnp(KIrp I);
	virtual NTSTATUS DefaultPower(KIrp I);

	// methods
	NTSTATUS InitializeTDI();
	VOID OnReceive(ReadWriteSession* session, PVOID Buffer, ULONG Size);

	// Member Data
protected:
	KPnpLowerDevice		m_Lower;

	ReadWriteSocket*					m_pListener;		// http socket

	PUCHAR				m_buffer;
	UCHAR				m_length;
	USHORT				m_block;
	ULONG				m_count;

	BroadcastSocket*	m_broadcast;

public:
	LIST_ENTRY			m_ListEntry;
};

#endif // __SERVDEV_H__
